package com.xflowresearch.nfv.sctpserver;


import java.io.IOException;
import java.net.InetAddress;
import java.net.InetSocketAddress;
import java.net.SocketAddress;
import java.nio.ByteBuffer;

import com.sun.nio.sctp.MessageInfo;
import com.sun.nio.sctp.SctpChannel;
import com.sun.nio.sctp.SctpServerChannel;

/**
* @author sandarenu
* $LastChangedDate$
* $LastChangedBy$
* $LastChangedRevision$
*/
public class SCTPServer {

    public static void main(String[] args) throws IOException, InterruptedException {
    	
    	InetAddress address = InetAddress.getByName("127.0.0.1");
        SocketAddress serverSocketAddress = new InetSocketAddress(address, 1111);
        System.out.println("create and bind for sctp address");
        SctpServerChannel sctpServerChannel =  SctpServerChannel.open().bind(serverSocketAddress);
        System.out.println("address bind process finished successfully");

        SctpChannel sctpChannel;
        while ((sctpChannel = sctpServerChannel.accept()) != null) 
        {
            System.out.println("client connection received");
            System.out.println("sctpChannel.getRemoteAddresses() = " + sctpChannel.getRemoteAddresses());
            System.out.println("sctpChannel.association() = " + sctpChannel.association());
          
            final ByteBuffer byteBuffer = ByteBuffer.allocate(64000);
            
            MessageInfo messageInfo = sctpChannel.receive(byteBuffer , null, null);
            System.out.println(messageInfo);
            
            
            
            byte[]data = new byte[64000];
            byteBuffer.get(data);
            
            String data1 = data.toString();
            System.out.println("Data Recieved:\n"+data1);
            
            
            Thread.sleep(5000);
            
			final ByteBuffer byteBuffer1 = ByteBuffer.allocate(64000);
			final MessageInfo messageInfo1 = MessageInfo.createOutgoing(null, 0);

			System.out.println("messageInfo = " + messageInfo1);
			System.out.println("messageInfo.streamNumber() = " + messageInfo1.streamNumber());

			byteBuffer1.put(new String("Hello").getBytes());
			byteBuffer1.flip();

			try {
				sctpChannel.send(byteBuffer1, messageInfo1);
			} catch (Exception e) {
				e.printStackTrace();
			}
            
        }
        
        
    }
}